@{
    ViewBag.Title = "Dashboard";
    Layout = "~/Views/Shared/_LayOutWithLatestKendoScript.cshtml";
}

<div class="row" style="margin-top:15px;margin-left:40px;margin-right:40px;">

    <div class="col-md-4"></div>
    <div class="col-md-4">
        <div id="TrdMrkChart"></div>
    </div>
    
    <div class="col-md-4"></div>
   

    <div class="row"></div>
    <div class="row" style="padding-left:25px; padding-right:25px;">
        <div class="col-lg-12">
            <div id="DetailGrid"></div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        GetPrject_CurrentStatus();
    });
    
    function GetPrject_CurrentStatus() {
        $.ajax({
            url: urlDrillDashBoard.ProjectDashBoard,
            dataType: "json",
            type: "POST",
            data: JSON.stringify({
                Code1: "TrdMrk",
                Code2: "TrdMrk",
                Code3: "TrdMrk",
            }),
            contentType: 'application/json; charset=utf-8',
            success: function (Data) {

                for (i = 0; i < Data.length; i++) {
                    PieChartDemo(Data, Data[i].Type)
                }
            }
        });
    }

    function PieChartDemo(Data, Type) {
        total = GetLentth(Data, Type)
        count = 0;
        countReg = 0;
        countExp = 0;

        for (var i = 0; i < Data.length; i++) {
            if (Data[i].currentstatus == "Pending") {
                count++;
            }
            else if (Data[i].currentstatus == "Registered") {
                countReg++;
            }

            else if (Data[i].currentstatus == "Expired") {
                countExp++;
            }

        }


        var data = [];
        data.push({ source: "Pending", Count: count });
        data.push({ source: "Registered", Count: countReg });
        data.push({ source: "Expired", Count: countExp });

        $("#TrdMrkChart").kendoChart({
            title: {
                text: "Trade Mark"
            },
            //chartArea: {
            //    background: "#ddddd4"
            //},
            legend: {
                position: "bottom"
            },
            dataSource: {
                data: data
            },
            series: [{
                type: "pie",
                field: "Count",
                categoryField: "source",
            }],
            seriesDefaults: {
                overlay: {
                    gradient: null
                },

                labels: {
                    visible: true,
                    background: "#fefffc",
                    template: "#= category #: \n #= value#"
                }
            },
            seriesColors: ["#ff9800", "#4caf50", "#ba1705"],
            tooltip: {
                //visible: true,
                //template: "${ category } : ${ value }"
            },
            seriesClick: function (e) {

                var Status = e.category;
                var ChartName = this.options.title.text.split(" ");
                var Title = ChartName[0];
                var ChartDetail = [];
                for (var i = 0; i < Data.length; i++) {
                    if (Data[i].currentstatus == Status) {
                        ChartDetail.push(Data[i]);
                    }
                }
                //$("#DetailGrid").show();
                //$("#DrilDownGrid").hide();
                //$("#DetailGrid").empty();
                LoadGrid1(ChartDetail);

                
            }
        });

    }

    function GetLentth(Data, type) {
        count = 0;
        for (var i = 0; i < Data.length; i++) {
            if (Data[i].Type == type) {
                count++;
            }

        }
        return count;
    }

    function LoadGrid1(ChartDetail) {
        var datasourceLoadGridView = new kendo.data.DataSource({

            data: ChartDetail,
            batch: true,
            pageSize: 20,
            schema: {
                model: {
                    fields:
                    {
                        Type: { editable: false, nullable: false, },
                        PRJKY: { editable: false, nullable: false, },
                        Title: { editable: false, nullable: false, },
                        Official: { editable: false, nullable: false, },
                        PrjNo: { editable: false, nullable: false },
                        Custodian: { editable: false, nullable: false },
                        AplicableLocation: { editable: false, nullable: false, },
                        currentstatus: { editable: false, nullable: false, },
                        DenseRank: { editable: false, nullable: false, },
                        FileID: { editable: false, nullable: false, },
                        Remarks: { editable: false, nullable: false, },
                        AprDtm: { editable: false, nullable: false, type: "string" },
                    }
                }
            }
        });

        $("#DetailGrid").kendoGrid({
            dataSource: datasourceLoadGridView,
            height: 200,
            navigatable: true,
            filterable: true,
            pageable: true,
            sortable: true,
            reorderable: true,
            columnMenu: false,
            selectable: "row",
            resizable: true,
            //toolbar: ["excel"],
            animation: {
                open: {
                    effects: "fadeIn zoom:in",
                    duration: 300
                }
            },
            pageable: { refresh: true, pageSizes: [5, 10, 20, 50, 100] },
            columns: [

                { field: "FileID", title: "File ID" },
                { field: "Official", title: "Official name of the third party" },
                { field: "PrjNo", title: "Number" },
                { field: "Title", title: "Title of the License/ Permit/ Certificates" },
                { field: "DenseRank", title: "Frequency" },
                { field: "Custodian", title: "Custodian(Responsibility" },
                { field: "Reqdtm", title: "Application Date" },//Pending
                { field: "RenvlDt", title: "RenewalDate" },//other
                { field: "ExpryDt", title: "Expiry Date" },//other
                { field: "currentstatus", title: "Status" },
                { field: "AplicableLocation", title: "Aplicable Location" },
                { field: "AprDtm", title: "Target Date for Approval" }, //pending
                { field: "Remarks", title: "Remarks" },
                { field: "Type", title: "Type", hidden: true },
                { field: "PRJKY", title: "PrjKy", hidden: true },
            ],

            editable: false,
            //excelExport: function (e) {
            //    var sheet = e.workbook.sheets[0];
            //    var template = kendo.template(this.columns[1].template);

            //    for (var i = 1; i < sheet.rows.length; i++) {
            //        var row = sheet.rows[i];

            //        var dataItem = {
            //            //UnitPrice: row.cells[1].value
            //        };

            //        row.cells[1].value = template(dataItem);
            //    }
            //}
        });
    }
</script>

<script>


    var urlDrillDashBoard = {
        ProjectDashBoard: '@Url.Content("~/Dashboard/GetPrject_CurrentStatus")',
        ProjectDashBoardwithTitle: '@Url.Content("~/Dashboard/Prject_CurrentStatus")',
        PrjCurrentStatusDetail: '@Url.Content("~/Dashboard/Prject_CurrentStatusDetails")',
        PrjCurrentStatusTrdMrk: '@Url.Content("~/Dashboard/PrjCurrentStatusTrdMrk")'
        };

    var viewBag = {
        ObjKy: '@(ViewBag.ObjKy)',
        OurCd: '@(ViewBag.OurCd)',
        OurCd2: '@(ViewBag.OurCd2)',
        ObjCaptn: '@(ViewBag.ObjCaptn)'

    }
</script>