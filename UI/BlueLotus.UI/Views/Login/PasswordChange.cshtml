@{
    ViewBag.Title = "PwdChange";
    Layout = "~/Views/Shared/_LoginLayout.cshtml";
    //Layout = "~/Views/Shared/_GanttLayout.cshtml";
}

<div class="form-module col-md-4  col-md-offset-4 col-sm-6 col-sm-offset-3">
    <div class="form">
        @*<form >*@
        @*<div id="login_for" class="col-md-6">*@
        @*<div class="form-group">
                <img src="/Images/Blue Lotus_Logo-01.png" style="height:60px;width:130px" />
            </div>*@
        <div class="form-group">
            <h2>Change Your Password</h2>

            <p style="font-size:12px">Hi <span id="txt"></span>, you can change your password</p>
        </div>
        <div class="form-group">
            <div class="row">
                <div class="col-md-6 col-sm-6 ">
                    <label>User Id</label>
                </div>
                <div class="col-md-12 col-sm-12">

                    <input type="text" name="username" id="username" readonly class="text readonly" />
                </div>
            </div>




        </div>
        <div class="form-group">
            <div class="row">
                <div class="col-md-6 col-sm-6 ">
                    <label>Password</label>
                </div>
                <div class="col-md-12 col-sm-12">
                    <input type="password" name="password1" id="password1" placeholder="New Password" autocomplete="off" class="text">
                    @*<input type="password" name="password" id="password" placeholder="Password" />*@
                </div>
                <div class="col-sm-6">
                    <span id="8char" class="glyphicon glyphicon-remove" style="color:#FF0004;"></span> 8 Characters Long<br>
                    <span id="ucase" class="glyphicon glyphicon-remove" style="color:#FF0004;"></span> One Uppercase Letter
                </div>
                <div class="col-sm-6">
                    <span id="lcase" class="glyphicon glyphicon-remove" style="color:#FF0004;"></span> One Lowercase Letter<br>
                    <span id="num" class="glyphicon glyphicon-remove" style="color:#FF0004;"></span> One Number
                </div>
            </div>




        </div>
        <div class="form-group">
            <div class="row">
                <div class="col-md-6 col-sm-6 ">
                    <label>Retype Password</label>
                </div>
                <div class="col-md-12 col-sm-12 ">
                    <input type="password" name="password2" id="password2" placeholder="Repeat Password" autocomplete="off" class="text">
                    @*<input type="password" name="retypepassword" id="retypepassword" placeholder="Retype Password" />*@
                </div>
                <div class="col-sm-12">
                    <span id="pwmatch" class="glyphicon glyphicon-remove" style="color:#FF0004;"></span> Passwords Match
                </div>
            </div>




        </div>
        <div class="form-group">
            <div class="row">
                <div class="col-md-6 col-sm-6 col-xs-6">
                    <button type="submit" class="k-button btn-success" id="Save" onclick="save()">Save</button>
                </div>
                <div class="col-md-6 col-sm-6 col-xs-6">

                    <button class="k-button  btn-success" id="cancel" onclick="Cancel()">Clear</button>
                </div>
            </div>




        </div>

        @*</form>*@


    </div>

</div>

@*<<div class="container">
        <div class="row">
            <div class="col-sm-12">
                <h1>Change Password</h1>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 col-sm-offset-3">
                <p class="text-center">Use the form below to change your password. Your password cannot be the same as your username.</p>
                <form method="post" id="passwordForm">
                    <input type="password" class="input-lg form-control" name="password1" id="password1" placeholder="New Password" autocomplete="off">
                    <div class="row">
                        <div class="col-sm-6">
                            <span id="8char" class="glyphicon glyphicon-remove" style="color:#FF0004;"></span> 8 Characters Long<br>
                            <span id="ucase" class="glyphicon glyphicon-remove" style="color:#FF0004;"></span> One Uppercase Letter
                        </div>
                        <div class="col-sm-6">
                            <span id="lcase" class="glyphicon glyphicon-remove" style="color:#FF0004;"></span> One Lowercase Letter<br>
                            <span id="num" class="glyphicon glyphicon-remove" style="color:#FF0004;"></span> One Number
                        </div>
                    </div>
                    <input type="password" class="input-lg form-control" name="password2" id="password2" placeholder="Repeat Password" autocomplete="off">
                    <div class="row">
                        <div class="col-sm-12">
                            <span id="pwmatch" class="glyphicon glyphicon-remove" style="color:#FF0004;"></span> Passwords Match
                        </div>
                    </div>
                    <input type="submit" class="col-xs-12 btn btn-primary btn-load btn-lg" data-loading-text="Changing Password..." value="Change Password">
                </form>
            </div><!--/col-sm-6-->
        </div><!--/row-->
    </div>*@
<style>
    #body {
        /*background: transparent url("/Images/test.jpg") repeat scroll 0% 0% / 100% 100%;*/
        /*background: #e4f1f6;*/
        font-family: Yu Gothic Light;
    }

    label {
        font-size: 14px;
    }

    .text {
        margin-bottom: 5px !important;
    }
</style>
<script src="~/Scripts/CommonFunction.js"></script>
<script type="text/javascript">
	$(document).ready(function () {
	    @*var UserKy = '@Session["usrKyTemp"]'
	    var UserId = '@Session["usrIdTemp"]'*@
	    var UserKy = '@(ViewBag.TempUsrKy)';
	    var UserId = '@(ViewBag.TempUsrId)';
		document.getElementById("txt").innerHTML = UserId

	  //  alert(UserKy);
	   // alert(UserId);
		//document.getElementById("username").value = "My value";
		$("#username").val(UserId);

	   // $("#username").value(UserId)




		//SelectText();
		//ValidatePwd();
		$("#password1").focus();
		//var height = $(window).height() - 70;
		//$("#body").height(height);

	});
    function save() {
        //'Session["usrKyTemp"]'
        var UserKy = '@(ViewBag.TempUsrKy)';
		var UsrId = $("#username").val();
		var password = $("#password1").val();
		var retypepassword = $("#password2").val();

		var ucase = new RegExp("[A-Z]+");
		var lcase = new RegExp("[a-z]+");
		var num = new RegExp("[0-9]+");
		if (password.length <8) {
			alert("Type 8 Characters");
		}
		else if (!ucase.test(password)) {
			alert("Type One Uppercase Letter");
		}
		else if (!lcase.test(password)) {
			alert("Type One Lowercase Letter");
		}
		else if (!num.test(password)) {
			alert("Type One Number");

		}
		else if (!password == retypepassword) {
			alert("Password Not Match ");
		}

		else {
			//alert("success");

			$.ajax({
				url: "@Url.Content("~/Login/PasswordChange")",
				data: JSON.stringify({
					UsrKy: UserKy,
					UsrId: UsrId,
					password: password,
					retypepassword: retypepassword
				}),
				contentType: 'application/json; charset=utf-8',
				dataType: "Json",
				type: "POST",
				success: function (data) {
				  @*//  alert("successfully Saved!");
				   // url: '@Url.Content("~/Login/Load_ObjCd")';
				   // url: "@Url.Content("~/Login/Index")";*@
				 @*//   @Html.Action("Index", "Login")*@
					if (data == true) {

				   window.location.href = "@Url.Action("logout", "Login")";
					}

				},
				error: function (e) {
					return false;
				}
			});
		}
		}




	$("input[type=password]").keyup(function(){
		var ucase = new RegExp("[A-Z]+");
		var lcase = new RegExp("[a-z]+");
		var num = new RegExp("[0-9]+");

		if($("#password1").val().length >= 8){
			$("#8char").removeClass("glyphicon-remove");
			$("#8char").addClass("glyphicon-ok");
			$("#8char").css("color","#00A41E");
		}else{
			$("#8char").removeClass("glyphicon-ok");
			$("#8char").addClass("glyphicon-remove");
			$("#8char").css("color","#FF0004");
		}

		if(ucase.test($("#password1").val())){
			$("#ucase").removeClass("glyphicon-remove");
			$("#ucase").addClass("glyphicon-ok");
			$("#ucase").css("color","#00A41E");
		}else{
			$("#ucase").removeClass("glyphicon-ok");
			$("#ucase").addClass("glyphicon-remove");
			$("#ucase").css("color","#FF0004");
		}

		if(lcase.test($("#password1").val())){
			$("#lcase").removeClass("glyphicon-remove");
			$("#lcase").addClass("glyphicon-ok");
			$("#lcase").css("color","#00A41E");
		}else{
			$("#lcase").removeClass("glyphicon-ok");
			$("#lcase").addClass("glyphicon-remove");
			$("#lcase").css("color","#FF0004");
		}

		if(num.test($("#password1").val())){
			$("#num").removeClass("glyphicon-remove");
			$("#num").addClass("glyphicon-ok");
			$("#num").css("color","#00A41E");
		}else{
			$("#num").removeClass("glyphicon-ok");
			$("#num").addClass("glyphicon-remove");
			$("#num").css("color","#FF0004");
		}

		if($("#password1").val() == $("#password2").val()){
			$("#pwmatch").removeClass("glyphicon-remove");
			$("#pwmatch").addClass("glyphicon-ok");
			$("#pwmatch").css("color","#00A41E");
		}else{
			$("#pwmatch").removeClass("glyphicon-ok");
			$("#pwmatch").addClass("glyphicon-remove");
			$("#pwmatch").css("color","#FF0004");
		}



	})
	//function ValidatePwd() {
	//    var password = document.getElementById("password");
	//    var confirm_password = document.getElementById("retypepassword");

	//    function validatePassword() {
	//        if (password.value != confirm_password.value) {
	//            confirm_password.setCustomValidity("Passwords Don't Match");
	//        } else {
	//            confirm_password.setCustomValidity('');
	//        }
	//    }

	//    password.onchange = validatePassword;
	//    confirm_password.onkeyup = validatePassword;

	//}
	var imageUrl = "/DevBL10/Images/15.jpg";
	// document.body.style.background = imageUrl;
	document.write('\
		<style>\
			#body{\
				background: transparent url('+ imageUrl +');\
				background-size:100% 100%;\
			}\
		</style>\
	');
	$("#password").keypress(function (e) {

		var keycode = (e.keyCode ? e.keyCode : e.which);
		if (keycode == '13') {
			$("#retypepassword").focus();
		}
	});
	$("#retypepassword").keypress(function (e) {

		var keycode = (e.keyCode ? e.keyCode : e.which);
		if (keycode == '13') {
			$("#Save").focus();
		}
	});

  @*$(document).keypress(function (e) {
	  if (e.which == 13) {
		  //
		  function UrlContent(action) {
			  return @Url.Content(action);
		  }
	  }

  });*@

@* function LoadCombo() {

	$("#company").kendoComboBox({
		dataValueField: "CKy",
		dataTextField: "CNm",
		dataSource: {
			type: "POST",
			transport: {
				read: '@Url.Action("GetComNm","Login")'
			}
		},
		filter: "contains",
		suggest: true,
		placeholder: "Select a Company.."
	});
	return false;
}*@


@*  function LoginOk() {
	//if ($("#company").data('kendoComboBox').value() != null) {
	if ($("#password").val() != null && $("#username").val() !=null) {
		$.ajax({
			url: '@Url.Action("LoginAccess", "Login")',
			data: JSON.stringify({
				CKy: $("#company").data('kendoComboBox').value(),
				password: $("#password").val(),
				username: $("#username").val()
			}),
			contentType: 'application/json; charset=utf-8',
			dataType: "Json",
			type: "POST",
			async: false,
			success: function () {

			},
			error: function () {

				return false;
			}
		});
	}
	else {
		alert();
		//alert("Plese Select The Company.");
		return false;
	}

}*@

	function Cancel() {

		$("#password1").val(null);
		$("#password2").val(null);
	}
</script>




