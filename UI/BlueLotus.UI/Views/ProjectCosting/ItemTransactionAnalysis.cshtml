@{
    ViewBag.Title = "ItemTransactionAnalysis";

    Layout = "~/Views/Shared/_LayOutWithLatestKendoScript_12_09.cshtml";

    @*Layout = "~/Views/Shared/_GanttLayout.cshtml";
        <link href='@Url.Content("~/Content/jquery-ui.css")' rel="stylesheet" type="text/css" />*@
}
<link rel="stylesheet" href="~/buttncss/style/css.css" type="text/css" />
<link rel="stylesheet" href="~/Images/BLBanner/style.css" type="text/css" />
<link rel="stylesheet" href="~/buttncss/style/ResFull.css" type="text/css" />

@*<script src='@Url.Content("~/Scripts/GridFunction/jquery.min.js")' type="text/javascript"></script>

    <script src='@Url.Content("~/Scripts/GridFunction/kendo.all.min.js")' type="text/javascript"></script>
    <script src='@Url.Content("~/Scripts/GridFunction/jszip.min.js")' type="text/javascript"></script>*@

@*<script src='@Url.Content("~/Scripts/js/jquery.min.js")' type="text/javascript"></script>
    <script src='@Url.Content("~/Scripts/js/jquery-ui.js")' type="text/javascript"></script>
    <script src='@Url.Content("~/Scripts/js/kendo.all.min.js")' type="text/javascript"></script>
    <script src="~/Scripts/HtnScripts/POS/kendo.all.min.js"></script>*@
@*<link href="~/Scripts/HtnScripts/POS/kendo.common.min.css" rel="stylesheet" />*@


@*@Html.Partial("~/Views/Errors/Index.cshtml")*@
<div class="nipmain">

    <div class="nipimg">
        <!--insert your image hear-->
        <img src="~/Images/BLBanner/img/ItmTrnAnl.png">
    </div>

    <div class="niphead" id="stockclosing">
        <h2>Item Transaction Analysis</h2>
    </div>
</div>
<div class="form">



    <div>

        <button class="analize" onclick="Analize()" data-tooltip="Analize"></button>
        <button class="preview" onclick="Preview()" data-tooltip="Preview"></button>

        <button class="cancel" onclick="Cancel()" data-tooltip="Cancel"> </button>

    </div>












    <div class="form-row">
        <label class="lbl" for=" datepicker">From Date:</label>

        <input class="cmb" id="FrmDate" value="2015/01/01" />

        <label class="lbl" for=" datepicker">To Date:</label>

        <input class="cmb" id="ToDate" value="2015/01/01" />
    </div>

    <div class="form-row">
        <label>Trn No From </label>

        <input id="TrnNoFrm" type="text" class=" k-textbox" />

        <label>Trn No To</label>

        <input id="TrnNoTo" type="text" class=" k-textbox" />

    </div>





    <div class="form-row">
        <label>Doc No </label>

        <input id="DocNo" type="text" class=" k-textbox" />

        <label>Your Ref No</label>

        <input id="YourRefNo" type="text" class=" k-textbox" />
    </div>


    <div class="form-row">


        <label class="lbl">Item Type</label>

        <input id="cmbItemTypNm" class="cmb" />


        <label class="lbl">Item Name</label>

        <input id="cmbItemNm" class="cmb" />

    </div>



    <div class="form-row">
        <label class="lbl">Location</label>
        <div class="cmb" id="cmbLoc"></div>

        <label class="lbl">Account </label>
        <div class="cmb" id="cmbAcc"></div>



    </div>

    <div class="form-row">
        <label class="lbl">Address</label>
        <div class="cmb" id="cmbAddrs"></div>

        <label class="lbl">Transaction Type </label>
        <div class="cmb" id="cmbTrnTyp"></div>



    </div>

    <div class="form-row">
        <label class="lbl">Project </label>
        <div class="cmb" id="cmbFmPrjNm"></div>

        <label class="lbl">Transaction Prefix </label>
        <div class="cmb" id="cmbTrnPrefix"></div>



    </div>


    <div class="form-row">

        <label class="lbl">BU</label>

        <div class="cmb" id="cmbBuNm"></div>

    </div>

    <div class="form-row">
        <label class="lbl">Analysis 1</label>



        <div class="cmb" id="cmbAnl1Nm"></div>


        <label class="lbl">Analysis 2</label>


        <div class="cmb" id="cmbAnl2Nm"></div>

    </div>

    <div class="form-row">

        <label class="lbl">Item Category 1</label>

        <input id="cmbItmCat1" class="cmb" />

        <label class="lbl">Item Category 2</label>

        <input id="cmbItmCat2" class="cmb" />

    </div>



</div>
<button class="filter_clear" data-tooltip="ClearFilter" onclick="ClearFilter()"></button>
<div id="grid" style="margin-top:10px"></div>



<style>
    .trr {
        padding: 4px 2px;
    }

    ::-webkit-scrollbar {
        display: none;
    }

    body {
        margin-right: -16px;
        overflow-y: scroll;
        overflow-x: hidden;
    }
</style>
<script>
    $(document).ready(function () {

        LoadCombo();
        LoadItm(1);
        var todayDate = new Date();
        $('#ToDate').data("kendoDatePicker").value(todayDate);
        var todayDate = new Date();
        $('#FrmDate').data("kendoDatePicker").value(todayDate);
        //  LoadGrid();
       // loadgrid();
    });
    $("#ToDate").kendoDatePicker({

        format: "dd/MM/yyyy",
        min: new Date(31, 2, 2000)
    });
    $("#FrmDate").kendoDatePicker({

        format: "dd/MM/yyyy",
        min: new Date(31, 2, 2000)
    });
    function ComboValidations(cmbNm) {

        var cmb = $("#" + cmbNm + "").data("kendoComboBox");
        var val = cmb.value();

        if (isNaN(val)) {
            alert("'" + val + "' is not a Valid input");
            $("#" + cmbNm + "").data('kendoComboBox').value("");
            return false;
        } else {
            return true;
        }
    }
    function LoadCombo() {


        $("#cmbFmPrjNm").kendoComboBox({
            dataValueField: "PrjKy",
            dataTextField: "PrjNm",
            dataSource: ProjectDatasource(),
            change: function (e) {
                var cmb = $("#cmbFmPrjNm").data("kendoComboBox");
                var prjky = cmb.value();
                if (prjky != "") {
                    var validate = ComboValidations("cmbFmPrjNm");
                    if (validate) {
                      //  $("#cmbFmPrjId").data("kendoComboBox").value(prjky);
                        $("#cmbFmPrjNm").data("kendoComboBox").value(prjky);
                        // LoadGridView1(prjky);
                        //sendPrjKy();
                        //LoadGridView(prjky);

                    } else {

                      //  $("#cmbFmPrjId").data("kendoComboBox").value("");
                        $("#cmbFmPrjNm").data("kendoComboBox").value("");
                    }
                }


            },
            filter: "contains",
            suggest: true,
            placeholder: "Select Project.."
        });

        $("#cmbItemTypNm").kendoComboBox({
            dataValueField: "CdKy",
            dataTextField: "CdNm",
            dataSource: ItmTypDatasource(),
            change: function (e) {
                var cmb = $("#cmbItemTypNm").data("kendoComboBox");
                var ItmTypKy = cmb.value();
                if (ItmTypKy != "") {
                    var validate = ComboValidations("cmbItemTypNm");
                    if (validate) {
                       // $("#cmbItemTypId").data("kendoComboBox").value(ItmTypKy);
                        $("#cmbItemTypNm").data("kendoComboBox").value(ItmTypKy);


                       // $("#cmbItemNm").data("kendoComboBox").value("");
                      //  $("#cmbItemId").data("kendoComboBox").value("");
                        LoadItm(ItmTypKy);
                        // LoadGridView1(prjky);
                        //sendPrjKy();
                        //LoadGridView(prjky);
                    } else {
                        $("#cmbItemTypNm").data("kendoComboBox").value("");
                      //  $("#cmbItemTypId").data("kendoComboBox").value("");
                    }
                }


            },
            filter: "contains",
            suggest: true,
            placeholder: "Select Item Type Name.."
        });



        $("#cmbAnl1Nm").kendoComboBox({
            dataValueField: "CdKy",
            dataTextField: "CdNm",

            dataSource: ComboDatasource("anltyp1"),
            change: function (e) {
                var cmb = $("#cmbAnl1Nm").data("kendoComboBox");
                var CdKy = cmb.value();
                if (CdKy != "") {
                    var validate = ComboValidations("cmbAnl1Nm");
                    if (validate) {
                        $("#cmbAnl1Nm").data("kendoComboBox").value(CdKy);
                        //  $("#cmbAnl1Id").data("kendoComboBox").value(CdKy);
                        // sendPrjKy();

                        //LoadGridView(prjky);
                    } else {
                        $("#cmbAnl1Nm").data("kendoComboBox").value("");
                        //  $("#cmbAnl1Id").data("kendoComboBox").value("");
                    }
                }

            },
            filter: "contains",
            suggest: true,
            placeholder: "Select Analysis 1.."
        });



        $("#cmbAnl2Nm").kendoComboBox({
            dataValueField: "CdKy",
            dataTextField: "CdNm",
            dataSource: ComboDatasource("anltyp2"),
            change: function (e) {
                var cmb = $("#cmbAnl2Nm").data("kendoComboBox");
                var CdKy = cmb.value();
                if (CdKy != "") {
                    var validate = ComboValidations("cmbAnl2Nm");
                    if (validate) {
                        $("#cmbAnl2Nm").data("kendoComboBox").value(CdKy);
                        //  $("#cmbAnl2Id").data("kendoComboBox").value(CdKy);
                        // sendPrjKy();

                        //LoadGridView(prjky);
                    } else {
                        $("#cmbAnl2Nm").data("kendoComboBox").value("");
                        //  $("#cmbAnl2Id").data("kendoComboBox").value("");
                    }
                }


            },
            filter: "contains",
            suggest: true,
            placeholder: "Select Analysis 2.."
        });


        $("#cmbAcc").kendoComboBox({
            dataValueField: "AccKy",
            dataTextField: "AccNm",
            dataSource: AccDatasource(),
            change: function (e) {
                var cmb = $("#cmbAcc").data("kendoComboBox");
                var AccKy = cmb.value();
                if (AccKy != "") {
                    var validate = ComboValidations("cmbAcc");
                    if (validate) {
                        $("#cmbAcc").data("kendoComboBox").value(AccKy);
                        // $("#cmbTskId").data("kendoComboBox").value(PrcsDetKy);
                        // sendPrjKy();
                        // LoadGridView1(prjky);
                        //LoadGridView(prjky);
                    } else {
                        $("#cmbAcc").data("kendoComboBox").value("");
                        // $("#cmbTskId").data("kendoComboBox").value("");
                    }
                }


            },
            filter: "contains",
            suggest: true,
            placeholder: "Select Account.."
        });


        $("#cmbAddrs").kendoComboBox({
            dataValueField: "AdrKy",
            dataTextField: "AdrNm",
            dataSource: AddrsDatasource(),
            change: function (e) {
                var cmb = $("#cmbAddrs").data("kendoComboBox");
                var AdrKy = cmb.value();
                if (AdrKy != "") {
                    var validate = ComboValidations("cmbAddrs");
                    if (validate) {
                        $("#cmbAddrs").data("kendoComboBox").value(AdrKy);
                        // $("#cmbTskId").data("kendoComboBox").value(PrcsDetKy);
                        // sendPrjKy();
                        // LoadGridView1(prjky);
                        //LoadGridView(prjky);
                    } else {
                        $("#cmbAddrs").data("kendoComboBox").value("");
                        // $("#cmbTskId").data("kendoComboBox").value("");
                    }
                }


            },
            filter: "contains",
            suggest: true,
            placeholder: "Select Address.."
        });

        $("#cmbTrnTyp").kendoComboBox({
            dataValueField: "CdKy",
            dataTextField: "CdNm",
            dataSource: ComboDatasource("trntyp"),
            change: function (e) {
                var cmb = $("#cmbTrnTyp").data("kendoComboBox");
                var CdKy = cmb.value();
                if (CdKy != "") {
                    var validate = ComboValidations("cmbTrnTyp");
                    if (validate) {
                        $("#cmbTrnTyp").data("kendoComboBox").value(CdKy);
                        // $("#cmbTskId").data("kendoComboBox").value(PrcsDetKy);
                        // sendPrjKy();
                        // LoadGridView1(prjky);
                        //LoadGridView(prjky);
                    } else {
                        $("#cmbTrnTyp").data("kendoComboBox").value("");
                        // $("#cmbTskId").data("kendoComboBox").value("");
                    }
                }


            },
            filter: "contains",
            suggest: true,
            placeholder: "Select transaction Type.."
        });

        $("#cmbLoc").kendoComboBox({
            dataValueField: "CdKy",
            dataTextField: "CdNm",
            dataSource: ComboDatasource("loc"),
            change: function (e) {
                var cmb = $("#cmbLoc").data("kendoComboBox");
                var CdKy = cmb.value();
                if (CdKy != "") {
                    var validate = ComboValidations("cmbLoc");
                    if (validate) {
                        $("#cmbLoc").data("kendoComboBox").value(CdKy);
                        // $("#cmbTskId").data("kendoComboBox").value(PrcsDetKy);
                        // sendPrjKy();
                        // LoadGridView1(prjky);
                        //LoadGridView(prjky);
                    } else {
                        $("#cmbLoc").data("kendoComboBox").value("");
                        // $("#cmbTskId").data("kendoComboBox").value("");
                    }
                }


            },
            filter: "contains",
            suggest: true,
            placeholder: "Select Location.."
        });


        $("#cmbTrnPrefix").kendoComboBox({
            dataValueField: "CdKy",
            dataTextField: "CdNm",
            dataSource: ComboDatasource("prefix"),
            change: function (e) {
                var cmb = $("#cmbTrnPrefix").data("kendoComboBox");
                var CdKy = cmb.value();
                if (CdKy != "") {
                    var validate = ComboValidations("cmbTrnPrefix");
                    if (validate) {
                        $("#cmbTrnPrefix").data("kendoComboBox").value(CdKy);
                     //   $("#cmbAnl4Id").data("kendoComboBox").value(CdKy);
                        // sendPrjKy();

                        //LoadGridView(prjky);
                    } else {
                        $("#cmbTrnPrefix").data("kendoComboBox").value("");
                      //  $("#cmbAnl4Id").data("kendoComboBox").value("");
                    }
                }


            },
            filter: "contains",
            suggest: true,
            placeholder: "Select Transaction Prefix.."
        });

        $("#cmbBuNm").kendoComboBox({
            dataValueField: "CdKy",
            dataTextField: "CdNm",
            dataSource: ComboDatasource("bu"),
            change: function (e) {
                var cmb = $("#cmbBuNm").data("kendoComboBox");
                var BuKy = cmb.value();
                if (BuKy != "") {
                    var validate = ComboValidations("cmbBuNm");
                    if (validate) {
                        $("#cmbBuNm").data("kendoComboBox").value(BuKy);
                        $("#cmbBuId").data("kendoComboBox").value(BuKy);
                        // sendPrjKy();
                        // LoadGridView1(prjky);
                        //LoadGridView(prjky);
                    } else {
                        $("#cmbBuNm").data("kendoComboBox").value("");
                        $("#cmbBuId").data("kendoComboBox").value("");
                    }
                }


            },
            filter: "contains",
            suggest: true,
            placeholder: "Select Bu Name.."
        });

        $("#cmbItmCat1").kendoComboBox({
            dataValueField: "CdKy",
            dataTextField: "CdNm",

            dataSource: ComboDatasource("itmcat1"),

            filter: "contains",
            suggest: true,
            //change:ChangeEvent,
            placeholder: "Select Item Category 1"

        });
        $("#cmbItmCat2").kendoComboBox({
            dataValueField: "CdKy",
            dataTextField: "CdNm",

            dataSource: ComboDatasource("itmcat2"),

            filter: "contains",
            suggest: true,
            //change:ChangeEvent,
            placeholder: "Select Item Category 2"

        });

            function ProjectDatasource() {
                var dataSource = new kendo.data.DataSource(
                  {
                      transport: {
                          read: {
                              url: '@Url.Content("~/WebReports/GetProject")',
                              dataType: "json"
                          }
                      }

                  });
                return dataSource;
            }

        function ItmTypDatasource() {
            var dataSource = new kendo.data.DataSource(
              {
                  transport: {
                      read: {
                          url: '@Url.Content("~/PNS_Reports/GetItmTyp")',
                          dataType: "json"
                      }
                  }

              });
            return dataSource;
        }



        function AddrsDatasource() {
            var dataSource = new kendo.data.DataSource(
              {
                  transport: {
                      read: {
                          url: '@Url.Content("~/WebReports/GetAddrs")',
                          dataType: "json"
                      }
                  }

              });
            return dataSource;
        }


        function AccDatasource() {
            var dataSource = new kendo.data.DataSource(
              {
                  transport: {
                      read: {
                          url: '@Url.Content("~/WebReports/GetAccount")',
                          dataType: "json"
                      },

                  }

              });
            return dataSource;
        }

        function ComboDatasource(ConCd) {
            var dataSource = new kendo.data.DataSource(
              {
                  transport: {
                      read: {
                          url: '@Url.Content("~/WebReports/GetComboData")',
                          dataType: "json"
                      },
                      parameterMap: function (options, operation) {

                          if (operation == "read") {
                              return ({
                                  ConCd: ConCd
                              });
                          }
                      }
                  }

              });
            return dataSource;
        }



    }


    function LoadItm(ItmTypKy) {

        $("#cmbItemNm").kendoComboBox({
            dataValueField: "ItmKy",
            dataTextField: "ItmNm",
            dataSource: ItmDatasource(),
            change: function (e) {
                var cmb = $("#cmbItemNm").data("kendoComboBox");
                var ItmTypKy = cmb.value();
                if (ItmTypKy != "") {
                    var validate = ComboValidations("cmbItemNm");
                    if (validate) {
                        // $("#cmbItemTypId").data("kendoComboBox").value(ItmTypKy);
                        $("#cmbItemNm").data("kendoComboBox").value(ItmTypKy);


                        //  $("#cmbItemNm").data("kendoComboBox").value("");
                        //  $("#cmbItemId").data("kendoComboBox").value("");
                        // LoadItm(ItmTypKy);
                        // LoadGridView1(prjky);
                        //sendPrjKy();
                        //LoadGridView(prjky);
                    } else {
                        $("#cmbItemNm").data("kendoComboBox").value("");
                        //  $("#cmbItemTypId").data("kendoComboBox").value("");
                    }
                }


            },
            filter: "contains",

            suggest: true,
            placeholder: "Select Item Name.."
        });

        function ItmDatasource() {
            var dataSource = new kendo.data.DataSource(
              {
                  transport: {
                      read: {
                          url: '@Url.Content("~/WebReports/GetItm")',
                          dataType: "json"
                      },
                      parameterMap: function (options, operation) {

                          if (operation == "read") {
                              return ({
                                  ItmTypKy: ItmTypKy
                              });
                          }
                      }
                  }

              });

            return dataSource;
        }

    }

    function Analize() {



        //var grid = $("#grid").data("kendoGrid");
        //grid.dataSource.data([]);

        var FrmDt = $("#FrmDate").val();
        if (FrmDt == null || FrmDt == undefined || FrmDt == "") {

            var FrmDt = null;
        }
        var ToDt = $("#ToDate").val();
        if (ToDt == null || ToDt == undefined || ToDt == "") {

            var ToDt = null;
        }

        var TrnNoFrm = $("#TrnNoFrm").val();

        if (TrnNoFrm == null || TrnNoFrm == undefined || TrnNoFrm == "") {

            var TrnNoFrm = "";
        }

        var TrnNoTo = $("#TrnNoTo").val();
        if (TrnNoTo == null || TrnNoTo == undefined || TrnNoTo == "") {

            var TrnNoTo = "";
        }
        var DocNo = $("#DocNo").val();
        var YurRef = $("#YourRefNo").val();
        var ItmTypKy = $("#cmbItemTypNm").data("kendoComboBox").value();

        if (ItmTypKy == null || ItmTypKy == undefined || ItmTypKy == "") {

            var ItmTypKy = 1;
        }

       var ItmKy = $("#cmbItemNm").data("kendoComboBox").value();

       if (ItmKy == null || ItmKy == undefined || ItmKy == "") {

            var ItmKy = 1;
        }


        var AccKy = $("#cmbAcc").data("kendoComboBox").value();

        if (AccKy == null || AccKy == undefined || AccKy == "") {

            var AccKy = 1;
        }
        var LocKy = $("#cmbLoc").data("kendoComboBox").value();

        if (LocKy == null || LocKy == undefined || LocKy == "") {

            var LocKy = 1;
        }


        var PrefixKy = $("#cmbTrnPrefix").data("kendoComboBox").value();

        if (PrefixKy == null || PrefixKy == undefined || PrefixKy == "") {

            var PrefixKy = 1;
        }


        var PrjKy = $("#cmbFmPrjNm").data("kendoComboBox").value();
        if (PrjKy == null || PrjKy == undefined || PrjKy == "") {

            var PrjKy = 1;
        }

        var BUKy = $("#cmbBuNm").data("kendoComboBox").value();
        if (BUKy == null || BUKy == undefined || BUKy == "") {

            var BUKy =1;
        }


        var AdrKy = $("#cmbAddrs").data("kendoComboBox").value();
        if (AdrKy == null || AdrKy == undefined || AdrKy == "") {

            var AdrKy = 1;
        }

        var TrnTypKy = $("#cmbTrnTyp").data("kendoComboBox").value();
        if (TrnTypKy == null || TrnTypKy == undefined || TrnTypKy == "") {

            var TrnTypKy = 1;
        }

        var Anl1Ky = $("#cmbAnl1Nm").data("kendoComboBox").value();
        if (Anl1Ky == null || Anl1Ky == undefined || Anl1Ky == "") {

            var Anl1Ky = 1;
        }

        var Anl2Ky = $("#cmbAnl2Nm").data("kendoComboBox").value();
        if (Anl2Ky == null || Anl2Ky == undefined || Anl2Ky == "") {

            var Anl2Ky = 1;
        }


        var ItmCat1Ky = $("#cmbItmCat1").data("kendoComboBox").value();
        if (ItmCat1Ky == null || ItmCat1Ky == undefined || ItmCat1Ky == "") {

            var ItmCat1Ky = 1;
        }

        var ItmCat2Ky = $("#cmbItmCat2").data("kendoComboBox").value();
        if (ItmCat2Ky == null || ItmCat2Ky == undefined || ItmCat2Ky == "") {

            var ItmCat2Ky = 1;
        }


        var columns = new Array();
        columns = [
             // { field: "TrnNo", width: "200px", format: "{0:N2}" },
        ];


        $.holdReady(true);
        $.ajax({

            type: "GET",
            dataType: 'json',
            data: {

                ToDt: ToDt,
                FrmDt: FrmDt,
                TrnNoFrm: TrnNoFrm,
                TrnNoTo: TrnNoTo,
                DocNo: DocNo,
                YurRef: YurRef,
                ItmTypKy: ItmTypKy,
                ItmKy: ItmKy,
                AccKy: AccKy,
                LocKy: LocKy,

                TrnTypKy: TrnTypKy,
                PrefixKy: PrefixKy,
                PrjKy: PrjKy,
                BUKy: BUKy,
                Anl1Ky: Anl1Ky,
                Anl2Ky: Anl2Ky,
                ItmCat1Ky: ItmCat1Ky,
                ItmCat2Ky: ItmCat2Ky,
                AdrKy: AdrKy,

            },
            url: '@Url.Action("ItmAnl_SelectColDet", "WebReports")',
            converters:
        {
            "text json": function (data) {
                return $.parseJSON(data, true, true);
            }
        },
            success: function (data) {
                //

                if(data==""){
                    alert("Data Not Available");
                    //var grid = $("#grid").data("kendoGrid");
                    //grid.dataSource.data([]);

                }
                for (var i = 0; i < columns.length; i++) { // Get and Bind the Column level Details
                    for (var k = data.length - 1; k >= 0 ; k--) {
                        if (columns[i]["field"] == data[k]) {
                            data.splice(k, 1); // Remove if column already defined
                        }
                    }
                }

                for (i = 0; i < data.length; i++) { // Get and Bind the Column level Details
                    columns.push({ field: data[i], title: data[i], locked: false, hidden: false, width: "150px" });
                    if (i + 1 == data.length) {
                        firstLoadData(columns);

                    }
                }

                $.holdReady(false);
            }
        });

        function firstLoadData(columns) {

            $.holdReady(true);
            $.ajax({
                type: "GET",
                dataType: 'json',
                data: { ObjKy: 81467 },
                url: '@Url.Action("UsrObjPrp_Select", "HtnShared")',
                converters:
            {
                "text json": function (data) {
                    return $.parseJSON(data, true, true);
                }
            },
                success: function (data) {

                    //for (i = 0; i < data[0].length; i++) { // Get and Bind the Column level Details
                    //    columns.push({ field: data[0][i], title: data[0][i] });
                    //}

                    for (var i = 0; i < data.length; i++) { // Get and Bind the Column level Details
                        for (var k = columns.length - 1; k >= 0 ; k--) {
                            if (columns[k]["field"] == data[i]["ObjNm"]) {
                                columns.splice(k, 1); // Remove if column already defined
                            }
                        }
                    }
                    for (var j = 0; j < data.length; j++) {
                        //alert(data[i]["ObjCd"]);
                        columns.push({ field: data[j]["ObjNm"], locked: (data[j]["isFreeze"] == 1) ? true : false, title: data[j]["ObjCaptn"], width: data[j]["Width"], format: data[j]["Format"] });

                        if (j + 1 == data.length) {
                            loadWithDetLevelData(columns, data);
                        }
                    }
                    $.holdReady(false);
                }
            });
        }

        function loadWithDetLevelData(columns, colData) {

            $.holdReady(true);
            $.ajax({
                type: "GET",
                dataType: 'json',
                data: {

                    ToDt: ToDt,
                    FrmDt: FrmDt,
                    TrnNoFrm: TrnNoFrm,
                    TrnNoTo: TrnNoTo,
                    DocNo: DocNo,
                    YurRef: YurRef,
                    ItmTypKy: ItmTypKy,
                    ItmKy: ItmKy,
                    AccKy: AccKy,
                    LocKy: LocKy,

                    TrnTypKy: TrnTypKy,
                    PrefixKy: PrefixKy,
                    PrjKy: PrjKy,
                    BUKy: BUKy,
                    Anl1Ky: Anl1Ky,
                    Anl2Ky: Anl2Ky,
                    ItmCat1Ky: ItmCat1Ky,
                    ItmCat2Ky: ItmCat2Ky,
                    AdrKy: AdrKy,
                },
                url: '@Url.Action("ItmAnl_Select", "WebReports")',
                converters:
            {
                "text json": function (data) {
                    return $.parseJSON(data, true, true);
                }
            },
                success: function (data) {
                    loadGrid(columns, colData, data)
                    $.holdReady(false);
                }
            });
        }

        function loadGrid(col, colData, dataSrcJsonString) {

            var gridBOQComponents_SelectWeb = new kendo.data.DataSource({
                @*transport: {
                    read: {
                        data: { PrjKy: 10575, PrcsDetKy: 1 },
                        url: "@Url.Content("~/HtnShared/ProjectResourceDetails_Select")", //urlProjectResourceDetails_Select
                    dataType: "json"
                }
            },
                batch: true,*@
                data: JSON.parse(dataSrcJsonString),
                pageSize: 10

        });

        try {
            $('#grid').data().kendoGrid.destroy();
            $('#grid').empty();
        } catch (e) { }
        $("#grid").kendoGrid({
            toolbar: ["excel"],
            excel: {
                fileName: "Kendo UI Grid Export.xlsx",
                //proxyURL: "//demos.telerik.com/kendo-ui/service/export",
                filterable: true
            },
            dataSource: gridBOQComponents_SelectWeb,
            sortable: true,
            pageable: true,
            groupable: true,
            filterable: true,
            //{
            //  mode: "row"
            //},
            pageable: {
                refresh: true,
                pageSizes: true,
                info: true,
                numeric: true,
                previousNext: true

            },
            columnMenu: true,
            reorderable: true,
            resizable: true,
            selectable: "row",
            editable: false,
            columns: col,
        });

        $("#grid").kendoTooltip({
            filter: "th", //this filter selects the first column title
            position: "top",
            width: "200px",
            content: function (e) {
                for (i = 0; i < colData.length; i++) {
                    //if (colData[i].isVisible != 0) {
                    var target = e.target.closest("th"); // element for which the tooltip is shown
                    var rtrn = $(target).text();

                    if ($(target).text() == colData[i].ObjCaptn) {
                        rtrn = colData[i].ToolTip;
                    }

                    return rtrn;
                    //}
                }
            }
        }).data("kendoTooltip");

       // createFilterRow();
    }
        @*$.ajax({
            url: "@Url.Content("~/WebReports/ItmTrnAnl")",
            data: JSON.stringify({


                ToDt: ToDt,
                FrmDt: FrmDt,
                TrnNoFrm: TrnNoFrm,
                TrnNoTo:TrnNoTo,
                DocNo: DocNo,
                YurRef: YurRef,
                ItmTypKy: ItmTypKy,
                ItmKy:ItmKy,
                AccKy: AccKy,
                LocKy: LocKy,

                TrnTypKy: TrnTypKy,
                PrefixKy: PrefixKy,
                PrjKy: PrjKy,
                BUKy: BUKy,
                Anl1Ky: Anl1Ky,
                Anl2Ky: Anl2Ky,
                ItmCat1Ky:ItmCat1Ky,
                ItmCat2Ky:ItmCat2Ky,
                AdrKy:AdrKy,

            }),
        contentType: 'application/json; charset=utf-8',
        dataType: "Json",
        type: "POST",
        success: function (data) {
            for (i = 0; i < data.length; i++) {

                $("#grid").data("kendoGrid").dataSource.add({

                    TrnDt: data[i].TrnDt,
                    TrnTyp: data[i].TrnTyp,
                    TrnNo: data[i].TrnNo,
                    DocNo: data[i].DocNo,
                    YurRef: data[i].YurRef,
                    PrjNm: data[i].PrjNm,
                    TrnExRate: data[i].TrnExRate,
                    TrnCrnCd: data[i].TrnCrnCd,
                    AdrNm: data[i].AdrNm,
                    LocNm: data[i].LocNm,
                    BUNm: data[i].BUNm,
                    Issues: data[i].Issues,
                    Qty: data[i].Qty,
                    Unit: data[i].Unit,
                    DisAmt: data[i].DisAmt,
                    Anl1Cd: data[i].Anl1Cd,
                    Anl2Cd: data[i].Anl2Cd,
                    ItmTypcd: data[i].ItmTypcd,
                    ItmCat1: data[i].ItmCat1,
                    ItmCat2: data[i].ItmCat2,
                    TrnAmt: data[i].TrnAmt,
                    PartNo: data[i].PartNo,
                    DetailDescription: data[i].DetailDescription,
                    HdrDescription: data[i].HdrDescription,
                    NetAmt: data[i].NetAmt,
                    EndUsr: data[i].EndUsr,
                    AprUsrId: data[i].AprUsrId,
                    EntDt: data[i].EntDt,
                    AdrCat1: data[i].AdrCat1,
                    AdrCat2: data[i].AdrCat2,






                })


            }

        }
             ,
        error: function (e) {
            return false;
        }
    });*@


    }
    //function loadgrid(){
    //    dataSource = new kendo.data.DataSource({


    //        transport: {
    //            read: {


    //                dataType: "json"
    //            },

    //            parameterMap: function (options, operation) {

    //                if (operation == "read") {
    //                    return ({



    //                    });
    //                }
    //            }
    //        },
    //        batch: true,
    //        pageSize: 10,
    //        //   group: [{ field: "date"}, { field: "Fg" }],
    //        schema: {
    //            model: {
    //                //  id: "Key",
    //                fields: {


    //                    TrnDt: { editable: false, nullable: false, type: "string" },
    //                    Prefix: { editable: false, nullable: false, type: "string" },
    //                    TrnNo: { editable: false, nullable: false, type: "string" },
    //                    DocNo: { editable: false, nullable: false, type: "string" },
    //                    YurRef: { editable: false, nullable: false, type: "string" },

    //                    PrjNm: { editable: false, nullable: false, type: "string" },
    //                    TrnExRate: { editable: false, nullable: false, type: "string" },
    //                    TrnCrnCd: { editable: false, nullable: false, type: "string" },
    //                    AdrNm: { editable: false, nullable: false, type: "string" },
    //                    LocNm: { editable: false, nullable: false, type: "string" },
    //                    BUNm: { editable: false, nullable: false, type: "string" },
    //                    Issues: { editable: false, nullable: false, type: "string" },
    //                    Qty: { editable: false, nullable: false, type: "string" },
    //                    Unit: { editable: false, nullable: false, type: "string" },
    //                    DisAmt: { editable: false, nullable: false, type: "number" },
    //                    Anl1Cd: { editable: false, nullable: false, type: "string" },
    //                    Anl2Cd: { editable: false, nullable: false, type: "string" },
    //                    ItmTypcd: { editable: false, nullable: false, type: "string" },
    //                    ItmCat1: { editable: false, nullable: false, type: "string" },
    //                    ItmCat2: { editable: false, nullable: false, type: "string" },
    //                    TrnAmt: { editable: false, nullable: false, type: "number" },
    //                    PartNo: { editable: false, nullable: false, type: "string" },
    //                    DetailDescription: { editable: false, nullable: false, type: "string" },
    //                    HdrDescription: { editable: false, nullable: false, type: "string" },
    //                    NetAmt: { editable: false, nullable: false, type: "number" },
    //                    EndUsr: { editable: false, nullable: false, type: "string" },
    //                    AprUsrId: { editable: false, nullable: false, type: "string" },
    //                    EntDt: { editable: false, nullable: false, type: "string" },
    //                    AdrCat1: { editable: false, nullable: false, type: "string" },
    //                    AdrCat2: { editable: false, nullable: false, type: "string" },





    //                }
    //            }
    //        },

    //        aggregate: [{ field: "DisAmt", aggregate: "sum", format: "{0:n}" },
    //         { field: "TrnAmt", aggregate: "sum", },

    //     { field: "NetAmt", aggregate: "sum", }, ],
    //    });
    //    $("#grid").kendoGrid({

    //        toolbar: ["excel", ],
    //        excel: {
    //            fileName: "Item Transaction Analysis.xlsx",
    //            filterable: true,
    //            allPages: true
    //        },
    //        dataSource: dataSource,

    //        navigatable: true,
    //        sortable: true,
    //        selectable: "row",
    //        pageable: true,
    //        //height: 395,
    //        resizable: true,
    //         groupable: true,
    //        columnMenu: true,
    //        reorderable: true,
    //        filterable:true,

    //        pageable: {
    //            refresh: true,
    //            pageSizes: true,
    //            info: true,
    //            numeric: true,
    //            previousNext: true

    //        },
    //        // columnHide: createFilterRow,
    //        // columnShow: createFilterRow,

    //        //filterable: {
    //        //        extra: false,
    //        //        operators: {
    //        //            string: {
    //        //                contains: "Contains",
    //        //            }
    //        //        }
    //        //    },

    //        columns: [

    //           { field: "TrnDt", title: "Trn Date",width:"150px" },
    //   { field: "Prefix", title: "Prefix", width: "150px" },
    //   { field: "TrnNo", title: "Trn No", width: "150px" },
    //   { field: "DocNo", title: "Doc No", width: "150px" },
    //   { field: "YurRef", title: "Your Ref", width: "150px" },
    //   { field: "PrjNm", title: "AProject Name", width: "150px" },
    //     { field: "TrnExRate", title: "TrnExRate", width: "150px" },
    //   { field: "TrnCrnCd", title: "TrnCrnCd", width: "150px" },
    //   { field: "AdrNm", title: "Adress Name", width: "150px" },
    //   { field: "LocNm", title: "Location Name", width: "150px" },
    //   { field: "BUNm", title: "BU Name", width: "150px" },
    //     { field: "Issues", title: "Issues", width: "150px" },
    //   { field: "Qty", title: "Qty", width: "150px" },
    //   { field: "Unit", title: "Unit", width: "150px" },
    //    { field: "DisAmt", title: "DisAmount", width: "150px", aggregates: ["sum"], footerTemplate: "<span style='float:right ; font-weight: bold;'>Total Dis Amount: #=kendo.toString(sum, 'n2') #</span>", groupFooterTemplate: "<span style='float:right; font-weight: bold;'>Amount: #=kendo.toString(sum, 'n2') #</span>", attributes: { style: "text-align: right" }, format: "{0:n2}" },
    //  // { field: "DisAmt", title: "DisAmt", width: "150px" },
    //   { field: "Anl1Cd", title: "Anlysis1 ", width: "150px" },
    //    { field: "Anl2Cd", title: "Anlysis2", width: "150px" },
    //   { field: "ItmTypcd", title: "Item Type", width: "150px" },
    //   { field: "ItmCat1", title: "Item Category 1", width: "150px" },
    //   { field: "ItmCat2", title: "Item Category 2", width: "150px" },
    //    { field: "TrnAmt", title: "Trn Amount", width: "150px", aggregates: ["sum"], footerTemplate: "<span style='float:right ; font-weight: bold;'>Total Trn Amount: #=kendo.toString(sum, 'n2') #</span>", groupFooterTemplate: "<span style='float:right; font-weight: bold;'>Amount: #=kendo.toString(sum, 'n2') #</span>", attributes: { style: "text-align: right" }, format: "{0:n2}" },
    //   //{ field: "TrnAmt", title: "Trn Amount", width: "150px" },
    //     { field: "PartNo", title: "Part No", width: "150px" },
    //   { field: "DetailDescription", title: "DetailDescription", width: "150px" },
    //   { field: "HdrDescription", title: "Header Description", width: "150px" },
    //    { field: "NetAmt", title: "Net Amount", width: "150px", aggregates: ["sum"], footerTemplate: "<span style='float:right ; font-weight: bold;'>Total Net Amount: #=kendo.toString(sum, 'n2') #</span>", groupFooterTemplate: "<span style='float:right; font-weight: bold;'>Amount: #=kendo.toString(sum, 'n2') #</span>", attributes: { style: "text-align: right" }, format: "{0:n2}" },
    //   //{ field: "NetAmt", title: "Net Amount", width: "150px" },
    //   { field: "EndUsr", title: "Ent User", width: "150px" },
    //     { field: "AprUsrId", title: "Apr UserId", width: "150px" },
    //   { field: "EntDt", title: "Ent Date", width: "150px" },
    //   { field: "AdrCat1", title: "AdrCat1", width: "150px" },
    //   { field: "AdrCat2", title: "AdrCat2", width: "150px" },






    //        ],


    //        editable: false
    //    });
    //    createFilterRow();
    //}


    function Preview() {


        //if ((PrjKy == 1 || PrjKy == undefined || PrjKy == "") || (AccKy == null || AccKy == undefined || AccKy == "")) {
        //    alert("Select Project or Account");
        //}
       // else {
            //
        var FrmDt = $("#FrmDate").val();
        if (FrmDt == null || FrmDt == undefined || FrmDt == "") {

            var FrmDt = null;
        }
        var ToDt = $("#ToDate").val();
        if (ToDt == null || ToDt == undefined || ToDt == "") {

            var ToDt = null;
        }

        var TrnNoFrm = $("#TrnNoFrm").val();

        if (TrnNoFrm == null || TrnNoFrm == undefined || TrnNoFrm == "") {

            var TrnNoFrm = "";
        }

        var TrnNoTo = $("#TrnNoTo").val();
        if (TrnNoTo == null || TrnNoTo == undefined || TrnNoTo == "") {

            var TrnNoTo = "";
        }
        var DocNo = $("#DocNo").val();
        var YurRef = $("#YourRefNo").val();
        var ItmTypKy = $("#cmbItemTypNm").data("kendoComboBox").value();

        if (ItmTypKy == null || ItmTypKy == undefined || ItmTypKy == "") {

            var ItmTypKy = 1;
        }

        var ItmKy = $("#cmbItemNm").data("kendoComboBox").value();

        if (ItmKy == null || ItmKy == undefined || ItmKy == "") {

            var ItmKy = 1;
        }


        var AccKy = $("#cmbAcc").data("kendoComboBox").value();

        if (AccKy == null || AccKy == undefined || AccKy == "") {

            var AccKy = 1;
        }
        var LocKy = $("#cmbLoc").data("kendoComboBox").value();

        if (LocKy == null || LocKy == undefined || LocKy == "") {

            var LocKy = 1;
        }


        var PrefixKy = $("#cmbTrnPrefix").data("kendoComboBox").value();

        if (PrefixKy == null || PrefixKy == undefined || PrefixKy == "") {

            var PrefixKy = 1;
        }


        var PrjKy = $("#cmbFmPrjNm").data("kendoComboBox").value();
        if (PrjKy == null || PrjKy == undefined || PrjKy == "") {

            var PrjKy = 1;
        }

        var BUKy = $("#cmbBuNm").data("kendoComboBox").value();
        if (BUKy == null || BUKy == undefined || BUKy == "") {

            var BUKy = 1;
        }


        var AdrKy = $("#cmbAddrs").data("kendoComboBox").value();
        if (AdrKy == null || AdrKy == undefined || AdrKy == "") {

            var AdrKy = 1;
        }

        var TrnTypKy = $("#cmbTrnTyp").data("kendoComboBox").value();
        if (TrnTypKy == null || TrnTypKy == undefined || TrnTypKy == "") {

            var TrnTypKy = 1;
        }

        var Anl1Ky = $("#cmbAnl1Nm").data("kendoComboBox").value();
        if (Anl1Ky == null || Anl1Ky == undefined || Anl1Ky == "") {

            var Anl1Ky = 1;
        }

        var Anl2Ky = $("#cmbAnl2Nm").data("kendoComboBox").value();
        if (Anl2Ky == null || Anl2Ky == undefined || Anl2Ky == "") {

            var Anl2Ky = 1;
        }


                $.ajax({
                    url: "@Url.Content("~/WebReports/AccAnlReport")",
                    data: JSON.stringify({

                        ToDt: ToDt,
                        FrmDt: FrmDt,
                        TrnNoFrm: TrnNoFrm,
                        TrnNoTo: TrnNoTo,
                        DocNo: DocNo,
                        YurRef: YurRef,
                        AccTypKy: AccTypKy,
                        AccKy: AccKy,
                        PrefixKy: PrefixKy,
                        PrjKy: PrjKy,
                        BUKy: BUKy,
                        Anl1Ky: Anl1Ky,
                        Anl2Ky: Anl2Ky


                    }),

                    contentType: 'application/json; charset=utf-8',
                    dataType: "Json",
                    type: "POST",
                    success: function (data) {

                        winDoialogElement = $("#idwin").kendoWindow({
                            width: 1000,
                            height: 1000
                        }).data("kendoWindow");
                        var url = "http://" + document.location.host + "/Report/AccAnlReport.aspx";
                        window.open(url, '_blank');

                    },
                    error: function (e) {
                        return false;
                    }
                });


        //  }

            }







            function Cancel() {
                var todayDate = new Date();
                $('#FrmDate').data("kendoDatePicker").value(todayDate);
                $('#ToDate').data("kendoDatePicker").value(todayDate);



                $("#TrnNoFrm").val(null);

                $("#TrnNoTo").val(null);

                 $("#DocNo").val(null);
                $("#YourRefNo").val(null);
                $("#cmbItemTypNm").data("kendoComboBox").value(null);

                $("#cmbItemNm").data("kendoComboBox").value(null);

              $("#cmbAcc").data("kendoComboBox").value(null);

                 $("#cmbLoc").data("kendoComboBox").value(null);

              $("#cmbTrnPrefix").data("kendoComboBox").value(null);


                $("#cmbFmPrjNm").data("kendoComboBox").value(null);

                 $("#cmbBuNm").data("kendoComboBox").value(null);

                 $("#cmbAddrs").data("kendoComboBox").value(null);

                $("#cmbTrnTyp").data("kendoComboBox").value(null);

                $("#cmbAnl1Nm").data("kendoComboBox").value(null);

              $("#cmbAnl2Nm").data("kendoComboBox").value(null);

                $("#cmbItmCat1").data("kendoComboBox").value(null);

               $("#cmbItmCat2").data("kendoComboBox").value(null);

                var grid = $("#grid").data("kendoGrid");
                grid.dataSource.data([]);
            }



</script>





